<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <!--vue依赖-->
  <script src="../../../map/vue-lib/vuejs/vue.js"></script>
  <!--elementui依赖-->
  <script src="../../../map/vue-lib/elementjs/index.js"></script>
  <link rel="stylesheet" href="../../../map/vue-lib/elementjs/index.css">
  <!--地图依赖js-->
<!--  <script src="../../../map/vue-lib/panda.gis.2d.min.js"></script>-->
  <script src="../../../map/vue-lib/jslib.js"></script>
  <!--地图配置文件-->
  <script src="../../../map/vue-lib/mapConfig.js"></script>
  <style>
    /*点扩散范围大小调整*/
    .leaflet-pulsing-icon:after {
      -webkit-border-radius: 100%;
      border-radius: 100%;
      height: 200%;
      width: 200%;
      position: absolute;
      margin: -50% 0 0 -50%;
    }
  </style>
  <script>
      function openRealTimeTest() {
          closeRealTimeTest();
          window.realObjects = [
              {"id": "1", "name": "闽D443HK", "x": 118.16585540771484, "y": 24.479598999023438},
              {"id": "2", "name": "闽D542FJ", "x": 118.14471659369913, "y": 24.522422570142833},
              {"id": "3", "name": "闽D652FJ", "x": 118.14471659369913, "y": 24.492422570142833},
              {"id": "4", "name": "闽D61112", "x": 118.10471659369913, "y": 24.522422570142833},
              {"id": "5", "name": "闽D5FGGJ", "x": 118.08757781982422, "y": 24.469985961914062}
          ];
          window.realtimeInterval = window.setInterval(this.setParam, 2000);
          mapVue.$refs.realtime.open(window.realObjects);
      }

      //添加模拟设备，只需添加到对应的数组数据中即可。
      window.testid = 5;//模拟idjo
      function addDataTest() {
          window.testid = window.testid + 1;
          //模拟坐标
          var zby = 24.44 + Math.random() * 0.10;
          var zbx = 118.08 + Math.random() * 0.10;
          var obj = {"id": window.testid, "name": "闽D443H" + window.testid, "x": zbx, "y": zby}
          window.realObjects.push(obj);
      }

      function setParam() {
          for (var i = 0; i < window.realObjects.length; i++) {
              var random1 = Math.random() * 0.003;
              var random2 = Math.random() * 0.003;
              var random3 = Math.random() * 0.003;
              //console.log(random1,random2,random3);
              window.realObjects[i].x = window.realObjects[i].x + (random1 - random2);
              window.realObjects[i].y = window.realObjects[i].y + (random1 - random3);
          }
      }

      function closeRealTimeTest() {
          window.realObjects = [];
          if (typeof (window.realtimeInterval) != "undefined") {
              window.clearInterval(window.realtimeInterval);
          }
          mapVue.$refs.realtime.close();
      }

  </script>
</head>
<body>
<div id="my-app">
  <map-component ref="map" :id="mapid" :type="type" :config="config" style='z-index:100;position: absolute;top: 0; bottom: 0;right: 0;left: 0;'></map-component>
  <!--realtime：实时时间设置,超过则表示离线（单位S）-->
  <realtime-component ref="realtime" id="realtime"
                      :real-time="300"
                      :map-ref="mapid"
  ></realtime-component>
  <el-button type="primary" onclick='openRealTimeTest();' style='z-index:1000;position:absolute;top:50px;left:60px'>
    开启实时组件
  </el-button>
  <el-button type="primary" onclick='closeRealTimeTest();' style='z-index:1000;position:absolute;top:100px;left:50px'>
    关闭实时组件
  </el-button>
  <el-button type="primary" onclick='addDataTest();' style='z-index:1000;position:absolute;top:150px;left:50px'>添加一个设备
  </el-button>
</div>
<script>
    var mapVue = new Vue({
        el: '#my-app',
        data: {
            mapid: "map",
            type: "js",
            config: window.defaultMapConfig,
        },
        components: {
            //前端
            'map-component': httpVueLoader('../../vue-map-component/leaflet/map-component.vue', 'frontEnd'),
            //前端
            'realtime-component': httpVueLoader('../../vue-map-component/tools/realtime-component.vue', 'frontEnd')
        }
    });
</script>
</body>
</html>
