<html lang="en">
<head>
  <meta charset=utf-8/>
  <!--vue依赖-->
  <script src="../../../map/vue-lib/vuejs/vue.js"></script>
  <!--elementui依赖-->
  <script src="../../../map/vue-lib/elementjs/index.js"></script>
  <link rel="stylesheet" href="../../../map/vue-lib/elementjs/index.css">
  <!--地图依赖js-->
  <!--  <script src="../../../map/vue-lib/leaflet.map.min.js"></script>-->
  <script src="../../../map/vue-lib/jslib.js"></script>
  <!--地图配置文件-->
  <script src="../../../map/vue-lib/mapConfig.js"></script>
  <script type="text/javascript">
    /**
     * 聚合图
     */
    function addClusterTest() {
      //聚合图标
      var iconJson = {};
      iconJson.option = {};
      iconJson.option.iconUrl = "../images/marker-icon.png";
      iconJson.option.iconAnchor = [21, 42];//坐标固定在图标的哪个点，[0,0]表示图标的左上角
      var markerIcon = mapVue.$refs.map.createIcon(iconJson);
      //模拟1000个聚合点
      var clusterMarkers = [];
      for (var i = 0; i < 1000; i++) {
        var markerJson = {};
        //xy坐标
        markerJson.xy = [24.42 + Math.random() * 0.10, 118.06 + Math.random() * 0.10];
        //marker参数设置
        markerJson.option = {};
        markerJson.option.icon = markerIcon;
        var marker = mapVue.$refs.map.createMarker(markerJson);
        marker.html = "聚合点：" + i;
        mapVue.$refs.map.bindPopup(marker);
        clusterMarkers.push(marker);
      }
      //singleMarkerMode: true  是否展示图标 true为数字1  false为marker图标
      var option = {};
      //如果设置该值，将会调用所设置的点击事件，如果不设置，将使用默认的事件处理
      option.clickCallBack = clusterClickFun;
      option.singleMarkerMode = false;//true 当数量为1的时候展示聚合点，false 当数量为1的时候展示位点
      option.maxClusterRadius = 80;//最大聚合像素，该配置影响地图的聚合数量
      option.iconCreateFunction = customStyle;
      var clusterLayer = mapVue.$refs.map.addCluster(clusterMarkers, option);
    }

    function clusterClickFun(result) {
      console.log("点击cluster所返回的数据情况", result);
    }

    //可自由定义聚合点的样式（祝大家能编写出满意的聚合图标样式）
    function customStyle(cluster) {
      var childCount = cluster.getChildCount();
      var html = "";
      if (childCount < 30) {
        html += '<div align="center" style="background-color: rgba(0, 0, 255, 0.6);width:40px"><span style="font-size: 14px;color: white">' + childCount + '</span></div>';
      } else if (childCount < 200) {
        html += '<div align="center" style="background-color: rgba(20, 20, 100, 0.6);width:60px"><span style="font-size: 14px;color: white">' + childCount + '</span></div>';
      } else {
        html += '<div align="center" style="background-color: rgba(255, 0, 0, 0.6);width:80px"><span style="font-size: 14px;color: white">' + childCount + '</span></div>';
      }
      return new L.DivIcon({
        html: html,
        iconAnchor:[20,10]
      });
    }
  </script>
</head>

<body>
<div id="my-app">
  <map-component ref="map" :id="id" :type="type" :config="config"
                 style='z-index:100;position: absolute;top: 0; bottom: 0;right: 0;left: 0;'></map-component>
  <el-button type="primary" onclick='addClusterTest();' style='z-index:1000;position:absolute;top:50px;left:50px'>聚合
  </el-button>
</div>
<script>

  var mapVue = new Vue({
    el: '#my-app',
    data: {
      //地图配置信息（必须）
      id: "map",
      type: "js",
      config: window.defaultMapConfig
    },
    components: {
      'map-component': httpVueLoader('../../vue-map-component/leaflet/map-component.vue', 'frontEnd')
    }
  });
</script>
</body>
</html>
